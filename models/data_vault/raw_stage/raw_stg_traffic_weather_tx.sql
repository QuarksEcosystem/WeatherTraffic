with weather as (SELECT *
       FROM {{ source ('weather_src', 'HISTORY_DAY')}}, {{ref('uszips')}} ref where ref.state_id = 'TX' and TRY_CAST(postal_code as INTEGER) = zip)
select 
trfc.COUNTRY,
trfc.FOOT_TRAFFIC_COUNT,
trfc.NUMBER_OF_LOCATIONS_DESCRIPTION,
trfc.STATE,
trfc.FILENAME,
trfc.FILE_ROW_SEQ,
trfc.LDTS,
trfc.RSCR,
trfc.TIMESTAMP,
trfc.TIMESTAMP_INTERVAL,
w.POSTAL_CODE,
w.DATE_VALID_STD,
w.DOY_STD,
w.MIN_TEMPERATURE_AIR_2M_F,
w.AVG_TEMPERATURE_AIR_2M_F,
w.MAX_TEMPERATURE_AIR_2M_F,
w.MIN_TEMPERATURE_WETBULB_2M_F,
w.AVG_TEMPERATURE_WETBULB_2M_F,
w.MAX_TEMPERATURE_WETBULB_2M_F,
w.MIN_TEMPERATURE_DEWPOINT_2M_F,
w.AVG_TEMPERATURE_DEWPOINT_2M_F,
w.MAX_TEMPERATURE_DEWPOINT_2M_F,
w.MIN_TEMPERATURE_FEELSLIKE_2M_F,
w.AVG_TEMPERATURE_FEELSLIKE_2M_F,
w.MAX_TEMPERATURE_FEELSLIKE_2M_F,
w.MIN_TEMPERATURE_WINDCHILL_2M_F,
w.AVG_TEMPERATURE_WINDCHILL_2M_F,
w.MAX_TEMPERATURE_WINDCHILL_2M_F,
w.MIN_TEMPERATURE_HEATINDEX_2M_F,
w.AVG_TEMPERATURE_HEATINDEX_2M_F,
w.MAX_TEMPERATURE_HEATINDEX_2M_F,
w.MIN_HUMIDITY_RELATIVE_2M_PCT,
w.AVG_HUMIDITY_RELATIVE_2M_PCT,
w.MAX_HUMIDITY_RELATIVE_2M_PCT,
w.MIN_HUMIDITY_SPECIFIC_2M_GPKG,
w.AVG_HUMIDITY_SPECIFIC_2M_GPKG,
w.MAX_HUMIDITY_SPECIFIC_2M_GPKG,
w.MIN_PRESSURE_2M_MB,
w.AVG_PRESSURE_2M_MB,
w.MAX_PRESSURE_2M_MB,
w.MIN_PRESSURE_TENDENCY_2M_MB,
w.AVG_PRESSURE_TENDENCY_2M_MB,
w.MAX_PRESSURE_TENDENCY_2M_MB,
w.MIN_PRESSURE_MEAN_SEA_LEVEL_MB,
w.AVG_PRESSURE_MEAN_SEA_LEVEL_MB,
w.MAX_PRESSURE_MEAN_SEA_LEVEL_MB,
w.MIN_WIND_SPEED_10M_MPH,
w.AVG_WIND_SPEED_10M_MPH,
w.MAX_WIND_SPEED_10M_MPH,
w.AVG_WIND_DIRECTION_10M_DEG,
w.MIN_WIND_SPEED_80M_MPH,
w.AVG_WIND_SPEED_80M_MPH,
w.MAX_WIND_SPEED_80M_MPH,
w.AVG_WIND_DIRECTION_80M_DEG,
w.MIN_WIND_SPEED_100M_MPH,
w.AVG_WIND_SPEED_100M_MPH,
w.MAX_WIND_SPEED_100M_MPH,
w.AVG_WIND_DIRECTION_100M_DEG,
w.TOT_PRECIPITATION_IN,
w.TOT_SNOWFALL_IN,
w.TOT_SNOWDEPTH_IN,
w.MIN_CLOUD_COVER_TOT_PCT,
w.AVG_CLOUD_COVER_TOT_PCT,
w.MAX_CLOUD_COVER_TOT_PCT,
w.MIN_RADIATION_SOLAR_TOTAL_WPM2,
w.AVG_RADIATION_SOLAR_TOTAL_WPM2,
w.MAX_RADIATION_SOLAR_TOTAL_WPM2,
w.TOT_RADIATION_SOLAR_TOTAL_WPM2,
w.ZIP,
w.LAT,
w.LNG,
w.CITY,
w.STATE_ID,
w.STATE_NAME,
w.ZCTA,
w.PARENT_ZCTA,
w.POPULATION,
w.DENSITY,
w.COUNTY_FIPS,
w.COUNTY_NAME,
w.COUNTY_WEIGHTS,
w.COUNTY_NAMES_ALL,
w.COUNTY_FIPS_ALL,
w.IMPRECISE,
w.MILITARY
 from {{ref('raw_stg_foot_traffic')}} trfc, weather w WHERE TO_DATE(timestamp) = date_valid_std